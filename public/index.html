<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIåç‰‡ç‹ Pro - æ™ºèƒ½åˆ†ç‰‡ç®¡ç†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); color: white; padding: 30px; text-align: center; border-radius: 15px; margin-bottom: 30px; }
        .card { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .card h2 { color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #667eea; }
        .btn { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px; margin-bottom: 10px; font-weight: 600; transition: transform 0.2s, box-shadow 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-secondary { background: linear-gradient(45deg, #11998e, #38ef7d); }
        .btn-danger { background: linear-gradient(45deg, #ff6b6b, #ee5a24); }
        .success { color: #27ae60; font-weight: 600; }
        .error { color: #e74c3c; font-weight: 600; }
        .info { color: #3498db; font-weight: 600; }
        .shard-info { background: linear-gradient(45deg, #f8f9fa, #e9ecef); padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #667eea; }
        .search-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { flex: 1; }
        .search-results { margin-top: 25px; max-height: 500px; overflow-y: auto; }
        .result-item { background: linear-gradient(45deg, #f8f9fa, #ffffff); padding: 15px; margin-bottom: 15px; border-radius: 10px; border-left: 4px solid #667eea; transition: transform 0.2s; }
        .result-item:hover { transform: translateX(5px); }
        .loading { text-align: center; padding: 20px; color: #666; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .stat-card { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; }
        .stat-label { font-size: 0.9em; opacity: 0.9; }
        .search-mode { display: flex; gap: 10px; margin-bottom: 15px; }
        .search-mode button { padding: 8px 16px; font-size: 12px; }
        .search-mode button.active { background: #667eea; }
        .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .progress-fill { height: 100%; background: linear-gradient(45deg, #667eea, #764ba2); transition: width 0.3s; }
        .auto-setup-panel { background: linear-gradient(45deg, #11998e, #38ef7d); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ AIåç‰‡ç‹ Pro</h1>
            <p>æ™ºèƒ½åˆ†ç‰‡ç®¡ç†ç³»çµ± - æ”¯æ´100è¬ç”¨æˆ¶ | æ¯«ç§’ç´šæœå°‹ | è‡ªå‹•åŒ–ç®¡ç†</p>
        </div>

        <!-- è‡ªå‹•è¨­å®šé¢æ¿ -->
        <div class="auto-setup-panel">
            <h2>âš¡ å¿«é€Ÿè¨­å®š</h2>
            <p>ä¸€éµè‡ªå‹•è¨­å®šåˆ†ç‰‡ç³»çµ±ï¼Œç„¡éœ€æ‰‹å‹•é…ç½®</p>
            <button class="btn btn-secondary" onclick="autoSetup()">ğŸ”§ è‡ªå‹•è¨­å®šåˆ†ç‰‡</button>
            <button class="btn btn-secondary" onclick="getShardStatus()">ğŸ“Š æŸ¥çœ‹åˆ†ç‰‡ç‹€æ…‹</button>
            <div id="setupResult"></div>
        </div>

        <!-- æ™ºèƒ½æœå°‹ -->
        <div class="card">
            <h2>ğŸ” æ™ºèƒ½æœå°‹</h2>
            <div class="search-mode">
                <button class="btn active" id="fastMode" onclick="setSearchMode('fast')">âš¡ å¿«é€Ÿæœå°‹</button>
                <button class="btn" id="parallelMode" onclick="setSearchMode('parallel')">ğŸ”„ ä¸¦è¡Œæœå°‹</button>
            </div>
            <div class="search-container">
                <input type="text" id="searchQuery" class="search-input" placeholder="è¼¸å…¥å§“åã€å…¬å¸æˆ–è·ä½..." onkeyup="handleSearchInput(event)">
                <button class="btn" onclick="performSearch()">æœå°‹</button>
                <button class="btn btn-secondary" onclick="clearSearch()">æ¸…é™¤</button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>

        <!-- ç”¨æˆ¶è¨»å†Š -->
        <div class="card">
            <h2>ğŸ‘¤ ç”¨æˆ¶è¨»å†Š</h2>
            <div class="input-group">
                <label>ç”¨æˆ¶ID (è‡ªå‹•åˆ†é…):</label>
                <input type="number" id="userId" placeholder="ç•™ç©ºè‡ªå‹•åˆ†é…ï¼Œæˆ–æ‰‹å‹•è¼¸å…¥1-1000000">
            </div>
            <div class="input-group">
                <label>å§“å:</label>
                <input type="text" id="userName" placeholder="è«‹è¼¸å…¥å§“å">
            </div>
            <div class="input-group">
                <label>å…¬å¸:</label>
                <input type="text" id="userCompany" placeholder="è«‹è¼¸å…¥å…¬å¸åç¨±">
            </div>
            <div class="input-group">
                <label>è·ä½:</label>
                <input type="text" id="userTitle" placeholder="è«‹è¼¸å…¥è·ä½">
            </div>
            <div class="input-group">
                <label>è¯çµ¡æ–¹å¼:</label>
                <input type="text" id="userContact" placeholder="é›»è©±æˆ–Email">
            </div>
            <button class="btn" onclick="registerUser()">ğŸ¯ æ™ºèƒ½è¨»å†Š</button>
            <button class="btn btn-secondary" onclick="batchRegister()">ğŸ“¦ æ‰¹é‡è¨»å†Š</button>
            <div id="registerResult"></div>
        </div>

        <!-- ç³»çµ±ç‹€æ…‹ -->
        <div class="card">
            <h2>ğŸ“Š ç³»çµ±ç‹€æ…‹</h2>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">ç¸½ç”¨æˆ¶æ•¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeShards">0</div>
                    <div class="stat-label">æ´»èºåˆ†ç‰‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="searchSpeed">0ms</div>
                    <div class="stat-label">æœå°‹é€Ÿåº¦</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="systemHealth">100%</div>
                    <div class="stat-label">ç³»çµ±å¥åº·åº¦</div>
                </div>
            </div>
            <div id="shardDetails"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://your-render-app.onrender.com/api';
        let currentSearchMode = 'fast';
        let searchTimeout;

        // è¨­å®šæœå°‹æ¨¡å¼
        function setSearchMode(mode) {
            currentSearchMode = mode;
            document.getElementById('fastMode').classList.toggle('active', mode === 'fast');
            document.getElementById('parallelMode').classList.toggle('active', mode === 'parallel');
        }

        // æ™ºèƒ½æœå°‹è¼¸å…¥è™•ç†
        function handleSearchInput(event) {
            if (event.key === 'Enter') {
                performSearch();
                return;
            }
            
            // é˜²æŠ–å‹•æœå°‹
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = event.target.value.trim();
                if (query.length >= 2) {
                    performSearch(true); // è‡ªå‹•æœå°‹
                }
            }, 300);
        }

        // åŸ·è¡Œæœå°‹
        async function performSearch(isAuto = false) {
            const query = document.getElementById('searchQuery').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query) {
                resultsDiv.innerHTML = '';
                return;
            }

            if (!isAuto) {
                resultsDiv.innerHTML = '<div class="loading">ğŸ” æœå°‹ä¸­...</div>';
            }

            const startTime = Date.now();
            
            try {
                const endpoint = currentSearchMode === 'fast' ? 'search-fast' : 'search-parallel';
                const response = await fetch(`${API_BASE}/${endpoint}?q=${encodeURIComponent(query)}`);
                const result = await response.json();
                
                const searchTime = Date.now() - startTime;
                document.getElementById('searchSpeed').textContent = `${searchTime}ms`;
                
                if (result.results && result.results.length > 0) {
                    let html = `
                        <div class="info">
                            âœ… æ‰¾åˆ° ${result.results.length} å€‹çµæœ (${searchTime}ms, ${result.source || result.search_time})
                        </div>
                    `;
                    
                    result.results.forEach(user => {
                        html += `
                            <div class="result-item">
                                <strong>${user.name}</strong> ${user.user_id ? `(ID: ${user.user_id})` : ''}
                                <br>ğŸ¢ ${user.company || 'N/A'}
                                <br>ğŸ’¼ ${user.title || 'N/A'}
                                <br>ğŸ“ åˆ†ç‰‡: ${user.shard_index}
                            </div>
                        `;
                    });
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<div class="info">ğŸ” æœªæ‰¾åˆ°ç›¸é—œçµæœ</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">âŒ æœå°‹éŒ¯èª¤: ${error.message}</div>`;
            }
        }

        // æ¸…é™¤æœå°‹
        function clearSearch() {
            document.getElementById('searchQuery').value = '';
            document.getElementById('searchResults').innerHTML = '';
        }

        // è¨»å†Šç”¨æˆ¶
        async function registerUser() {
            const userId = parseInt(document.getElementById('userId').value) || Math.floor(Math.random() * 1000000) + 1;
            const userData = {
                name: document.getElementById('userName').value,
                company: document.getElementById('userCompany').value,
                title: document.getElementById('userTitle').value,
                contact: document.getElementById('userContact').value,
                created_at: new Date().toISOString()
            };

            if (!userData.name) {
                showResult('registerResult', 'è«‹å¡«å¯«å§“å', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, user_data: userData })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult('registerResult', `
                        âœ… è¨»å†ŠæˆåŠŸï¼
                        <div class="shard-info">
                            ç”¨æˆ¶ID: ${userId}<br>
                            åˆ†ç‰‡: ${result.shard_info.index}<br>
                            ç‹€æ…‹: ${result.shard_info.status}
                        </div>
                    `, 'success');
                    
                    // æ›´æ–°çµ±è¨ˆ
                    updateStats();
                } else {
                    showResult('registerResult', `âŒ è¨»å†Šå¤±æ•—: ${result.error}`, 'error');
                }
            } catch (error) {
                showResult('registerResult', `âŒ ç¶²è·¯éŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        // æ‰¹é‡è¨»å†Š
        async function batchRegister() {
            const count = parseInt(prompt('è¦æ‰¹é‡è¨»å†Šå¤šå°‘å€‹æ¸¬è©¦ç”¨æˆ¶ï¼Ÿ', '10'));
            if (!count || count < 1) return;

            const resultsDiv = document.getElementById('registerResult');
            resultsDiv.innerHTML = '<div class="loading">ğŸ“¦ æ‰¹é‡è¨»å†Šä¸­...</div>';

            let successCount = 0;
            for (let i = 0; i < count; i++) {
                const userId = Math.floor(Math.random() * 1000000) + 1;
                const userData = {
                    name: `æ¸¬è©¦ç”¨æˆ¶${i + 1}`,
                    company: `å…¬å¸${Math.floor(Math.random() * 100)}`,
                    title: `è·ä½${Math.floor(Math.random() * 10)}`,
                    contact: `test${i}@example.com`
                };

                try {
                    const response = await fetch(`${API_BASE}/register`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user_id: userId, user_data: userData })
                    });

                    if (response.ok) successCount++;
                } catch (error) {
                    console.error('æ‰¹é‡è¨»å†ŠéŒ¯èª¤:', error);
                }

                // æ›´æ–°é€²åº¦
                const progress = Math.round((i + 1) / count * 100);
                resultsDiv.innerHTML = `
                    <div class="loading">ğŸ“¦ æ‰¹é‡è¨»å†Šä¸­... ${i + 1}/${count}</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
            }

            showResult('registerResult', `âœ… æ‰¹é‡è¨»å†Šå®Œæˆï¼æˆåŠŸ: ${successCount}/${count}`, 'success');
            updateStats();
        }

        // è‡ªå‹•è¨­å®š
        async function autoSetup() {
            const resultsDiv = document.getElementById('setupResult');
            resultsDiv.innerHTML = '<div class="loading">ğŸ”§ è‡ªå‹•è¨­å®šä¸­...</div>';

            try {
                const response = await fetch(`${API_BASE}/auto-setup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult('setupResult', `
                        âœ… ${result.message}
                        <br>æ´»èºåˆ†ç‰‡: ${result.active_shards}
                    `, 'success');
                    updateStats();
                } else {
                    showResult('setupResult', `âŒ è¨­å®šå¤±æ•—: ${result.error}`, 'error');
                }
            } catch (error) {
                showResult('setupResult', `âŒ è¨­å®šéŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        // ç²å–åˆ†ç‰‡ç‹€æ…‹
        async function getShardStatus() {
            try {
                const response = await fetch(`${API_BASE}/shard-status`);
                const result = await response.json();
                
                document.getElementById('activeShards').textContent = result.active_shards;
                
                let html = '<h3>ğŸ“Š åˆ†ç‰‡è©³æƒ…</h3>';
                const activeShards = result.shards.filter(s => s.status === 'active');
                activeShards.slice(0, 5).forEach(shard => {
                    const usage = Math.round((shard.user_count / shard.max_users) * 100);
                    html += `
                        <div class="shard-info">
                            åˆ†ç‰‡ ${shard.index}: ${shard.user_count}/${shard.max_users} ç”¨æˆ¶ (${usage}%)
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${usage}%"></div>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('shardDetails').innerHTML = html;
            } catch (error) {
                console.error('ç²å–åˆ†ç‰‡ç‹€æ…‹éŒ¯èª¤:', error);
            }
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            // é€™è£¡å¯ä»¥å¯¦ç¾å¯¦æ™‚çµ±è¨ˆæ›´æ–°
            getShardStatus();
        }

        // é¡¯ç¤ºçµæœ
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // æ¯30ç§’æ›´æ–°ä¸€æ¬¡çµ±è¨ˆ
            setInterval(updateStats, 30000);
        });
    </script>
</body>
</html>
